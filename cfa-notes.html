<head>
  <link type="text/css" rel="stylesheet" href="mperdikeasgithub.css"/>
  <link rel='icon' href='/knowledge-favicon.ico'/>
</head>
<body>
  <h1>notes on the CfA environment</h1>
  <ol reversed class=main-list-items>
    <li>location of the proposal DDL scripts and SPs (of which there are legion)</li>
    <pre>vobs/ASC_DB_FLIGHT/src/db/proposal/SQL/ddl_proposal</pre>
    <li>how to grep the release DDL</li>
    <p style='size: 90%'>source: TB email 2017-04-25</p>
    <p>
      E.g. suppose we want to discover which database hosts a table <tt>cda_mail</tt>. We do a:
      <pre>
$ grep cda_mail /home/ascds/DS.release/config/db/arcops/ddl_* | grep -i create\ table
/home/ascds/DS.release/config/db/arcops/ddl_obstat:create table cda_mail</pre>
      &hellip; from the name of the file that contains this statement above (<tt>ddl_obstat</tt>)
      we gather that it is the <tt>obstat</tt> database that holds this table. 
    </p>
    <p>
      We are subsequently able to connect with:
      <pre>sqsh -S sqldev -D axafobstat -U dbm -J iso_1</pre>
      &hellip; once inside (after the password prompt) we can view all tables with <tt>sp_ls</tt>
      and do a <tt>select * from cda_mail</tt> to see the data.
    </p>
    <li>DDL for the <tt>axaf_users</tt> database</li>
    <pre>vobs/ASC_DB_WEB/src/db/www/cxcusers/SQL/ddl_axafusers</pre>
    <li>preview server</li>
    <p>
      For the non-SSL preview server the URL is:
      <a href='http://cxc-dmz-prev.cfa.harvard.edu/soft/cps/CPS.html'>
         http://cxc-dmz-prev.cfa.harvard.edu/soft/cps/CPS.html
      </a>
    </p>
    <li>configuration and log files for secure test deployment</li>
    <p>
      For the test deployment on the secure (SSL) server at <a href='https://cxc-dmz.test/'>https://cxc-dmz.test/</a> (e.g. <a href='https://cxc-dmz.test/soft/cps/CPS.html'>https://cxc-dmz.test/soft/cps/CPS.html</a>)
      the following diagram shows the proxy / origin server arrangements:
      <pre>
                          *~~~~~~~~~~~~*               *~~~~~~~~*
                          |cxc-dmz-test|               |        |
[browser] --- (HTTPS) --> |Apache      | --- (HTTP) -->| Tomcat |
                          *~~~~~~~~~~~~*               *~~~~~~~~* </pre>
    </p>
    <p>
      Moreover, from what I was made to understand, there is a further
      load balancer at the very front. But at any rate the server
      at <tt>cxc-dmz-test</tt> acts as an SSL offloader (or <i>SSL terminator</i>
      or <i>TSL terminator</i>).
    </p>
    <p>
      <ul>
        <li>
          The <tt>httpd.conf</tt> file for the Apache server is:
          <pre>/proj/web-cxc-secure-test/conf/httpd_2.2.15.conf</pre>
          Typical <tt>ps</tt> line for the Apache:
          <pre>cxcweb   28814 11429  0 13:41 ?        00:00:00 /usr/sbin/httpd -DSSL -f /proj/web-cxc-secure-test/conf/httpd_2.2.15.conf</pre>
        </li>
        <li>The configuration files for the Tomcat server area at:
          <pre>/proj/web-cxc-secure-test/catalina_base/soft/conf/</pre>
          Typical <tt>ps</tt> line for Tomcat:
          <pre>cxcweb   25794     1  0 08:15 ?        00:00:37 /proj/cm/Release/ots.install.DS10.4/jdk-1.7.0.75.Linux64/bin/java -server -classpath /soft/SYBASE15.7/jConnect-7_0/classes/jconn4.jar:/usr/share/tomcat/lib/servlet-api.jar:.:/usr/share/tomcat/bin/bootstrap.jar:/usr/share/tomcat/bin/tomcat-juli.jar:/usr/share/java/commons-daemon.jar -Dcatalina.base=/proj/web-cxc-secure-test/catalina_base/soft -Dcatalina.home=/usr/share/tomcat -Djava.endorsed.dirs= -Djava.io.tmpdir=/export/servers/cxc-secure-test/tomcat/tmp -Djava.util.logging.config.file=/proj/web-cxc-secure-test/catalina_base/soft/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager org.apache.catalina.startup.Bootstrap start</pre>
        </li>
        <li>The log file for the CPS Tomcat application is at:
<pre>/data/rpc_test/prop/cps/cps.log</pre>
        </li>        
        <li>The CPS application can be accessed at:
          <a href='https://cxc-dmz-test/soft/cps/CPS.html'>
            https://cxc-dmz-test/soft/cps/CPS.html
          </a>
        </li>
      </ul>
    </p>
    <li>file where the sqsh aliases are defined</li>
    <pre>/soft/SYBASE15.7/interfaces</pre>
    <li>Acronyms and names</li>
    <dl>
      <dt>ACIS</dt><dd>This is the main instrument of Chandra</dd>      
      <dt>AO</dt><dd>Announcement of Opportunity</dd>
      <dt>ASC</dt><dd>AXAF Science Center (AXAF was the original satellite's name before it got renamed to Chandra)</dd>
      <dt>Axaf</dt><dd>The name of the Chandra satellite before its launch</dd>
      <dt>CDO</dt><dd>Chandra Director's Office</dd>      
      <dt>CFHelp</dt><dd>Computation Facility Help (this is CfA-wide)</dd>
      <dt>CPS</dt><dd>Chandra Proposal System</dd>
      <dt>OCat</dt><dd>Observing Catalogue</dd>
      <dt>RPS</dt><dd>Proposal database</dd>
      <dt>SysHelp</dt><dd>Systems Help (this is HEAD)</dd>
      <dt>TOO</dt><dd>Target Of Opportunity</dd>
      <dt>UDB</dt><dd>User Database</dd>
    </dl>    
    
    <li>Design description (documentation) for the SR interfaces</li>
    Available here:
    <pre>/proj/ascds/staff/UDF/Databases/search_retrieve/DesignDescription/SRServices_interface</pre>
    <li>instructions on how to setup JBoss</li>
    They are available here:
    <pre>vobs/ASC_DB_ADMIN/src/db/www/webadmin/jboss_setup</pre>
    <li>how to insert / update records in tables <code>axafusers.person</code> and <code>axafusers.person_short</code></li>
    <p>
      The code for the stored procedure to use is here:
      <pre>vobs/ASC_DB_ADMIN/src/db/www/cxcusers/SQL/sp_axafusers_person_apply</pre>
    </p>
    <p>
      For <b>insert</b>, pass <tt>@pers_id_in</tt> as <tt>0</tt>.
    </p>
    <p>
      The above stored procedure can be used for <b>update</b> as well, however, for some reason, we are instead using:
      <tt>sp_axafusers_person_update</tt> (in the same directory). When calling this procedure do the
      following for any parameters that are <b>not</b> to be updated:
      <ul>
        <li>Pass "X" for the <tt>@type</tt> and <tt>@is_coi</tt> parameters</li>
        <li>Pass "undef" for all other parameters</li>
      </ul>
    </p>
    <p>
      <span class='nb'>NB:</span> The above statement (about using <tt>sp_axafusers_person_update</tt>
      for updates) is wrong. PH confirmed to me on <i>2017-05-09</i> that <tt>sp_axafusers_person_apply</tt>
      can just as well be used for updates and that in fact the <tt>sp_axafusers_person_update</tt>
      was developed in response to a somewhat different use case (some people needed a CLI-type interface
      to easily update only the specific fields the cared about).
    </p>
      
  </ol>
</body>
