<html>
<head>
<link type="text/css" rel="stylesheet" href="mperdikeasgithub.css"/>
<link type="text/css" rel="stylesheet" href="final-code-wavetheory-lightbox.css">
</head>
<body>
<ol reversed>
<li>Ant failing to find Ivy jar</li>
It appears that <b>Ant 1.7</b> fails to find the Ivy jar if placed in the user-specific location (e.g. <code>~/.ant/lib/ivy-2.3.0.jar</code>).
<br/>
E.g. the following <code>build.xml</code> file:
<pre>
&lt;project
    xmlns:ivy="antlib:org.apache.ivy.ant"
    name="test" default="test-ivy"&gt;
&lt;target name="test-ivy"&gt;
    &lt;ivy:settings /&gt;
&lt;/target&gt;
&lt;/pre&gt;
&lt;/project&gt;
</pre>
&hellip; fails with
<pre>
$ whoami
voops
$ ant
Buildfile: build.xml

test-ivy:

BUILD FAILED
/home/voops/test/build.xml:7: Problem: failed to create task or type antlib:org.apache.ivy.ant:settings
Cause: The name is undefined.
Action: Check the spelling.
Action: Check that any custom tasks/types have been declared.
Action: Check that any <presetdef>/<macrodef> declarations have taken place.
No types or tasks have been defined in this namespace yet

This appears to be an antlib declaration. 
Action: Check that the implementing library exists in one of:
        -/usr/share/ant/lib
        -/home/voops/.ant/lib
        -a directory added on the command line with the -lib argument


Total time: 0 seconds
</pre>
<br/>
In this case, and for <b>Ant 1.7</b>, the problem is solved by adding the following element:
<pre>
    &lt;taskdef uri="antlib:org.apache.ivy.ant" resource="org/apache/ivy/ant/antlib.xml" classpath="${user.home}/.ant/lib/ivy-2.3.0.jar"/&gt;
</pre>
&hellip; resulting in the following <code>build.xml</code> file that "builds" correctly:
<pre>
&lt;project
    xmlns:ivy="antlib:org.apache.ivy.ant"
    name="test" default="test-ivy"&gt;
    &lt;taskdef uri="antlib:org.apache.ivy.ant" resource="org/apache/ivy/ant/antlib.xml" classpath="${user.home}/.ant/lib/ivy-2.3.0.jar"/&gt;
&lt;target name="test-ivy"&gt;
    &lt;ivy:settings /&gt;
&lt;/target&gt;
&lt;/pre&gt;
&lt;/project&gt;
</pre>
Since <b>Ant</b> is supposed to look in <code>~/.ant/lib</code> for libraries in any case (and the error message indicates as such), it is
a mystery why the location of the Ivy jar has to be explicitly spelled out. See also my <a href="http://stackoverflow.com/q/26929133/274677">SO question</a>
on the matter. At any rate, as noted in my question, this problem does not appear with Ant versions <b>1.8.2</b> and <b>1.9.4</b>.

<li><a name="ivy-locations">Ivy installation locations</li>
Ivy is just a <b>jar</b> file. This jar can be placed in two locations depending on whether
we want to do a system-wide or a user-specific installation:
<ul>
    <li>system-wide</li>
    <pre>
    $ ls /usr/share/ant/lib/ivy-2.2.0.jar 
    -rw-r--r-- 1 root root 947592 Jun  5  2013 /usr/share/ant/lib/ivy-2.2.0.jar
    </pre>
    <li>user-specific</li>
    <pre>
    $ ls ~/.ant/lib/ivy-2.3.0.jar 
    -rw-r--r-- 1 mperdikeas users 1222059 Jan 10  2013 /home/mperdikeas/.ant/lib/ivy-2.3.0.jar
    </pre>
</ul>
<br/>
NB. user-specific installation (if present) obviously trumps the system-wide. So, in the above
case the version of <b>Ivy</b> installed is <i>2.3</i>, not <i>2.2</i>.
<br/><br/>
<li>sometimes you just have to use <b>find</b> to invoke a series of <b>Ant</b> files ..</li>
In those cases the below archetype will prove helpful:
<pre>
#!/usr/bin/env bash
EXPR=/usr/bin/expr
/bin/false
START=$(/bin/date +%s)
RESULT=0
COUNTER=0
while IFS= read -r -u3 -d $'\0' file; do
        echo -n "building $file ..."
        ant -f "$file" build > "$file.log" 2>&1 &&
           echo "success" ||
           { echo "failure" && cat "$file.log" ; RESULT=1 ; break; }
        COUNTER=$((COUNTER + 1))
done 3< <(find a b c d -iname build.xml -print0)

END=$(/bin/date +%s)
DIFF=$($EXPR $END - $START)

if [ $RESULT -eq 0 ]
then
    echo "! build successfully concluded for all $COUNTER projects in $DIFF seconds"
else
    echo "X build failed after $COUNTER projects"
fi
</pre>
<a href="http://unix.stackexchange.com/a/153973/24044">source</a>
<li>simple solution to quickly profile a Java program</li>
Use the "random pause" technique with the help of the <b>jstack</b> program.
So, if the java process id (easily obtained with <b>jps</b>) is 30600, invoking the follow a few (~10) times:
<pre>
jstack -l 30600
</pre>
... should give you a pretty good idea of where the performance bottleneck is.
SO posts: <a href="http://stackoverflow.com/q/6846049/274677">here</a> and <a href="http://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024">here</a>.
<li>how to see the stack of a frozen Java program if <b>jconsole</b> and <b>jvisualvm</b> don't work
for some reason.</li>
StackOverflow question <a href="http://stackoverflow.com/q/22460019/274677">here</a>.
Java sample code (to test <i>kill -3</i>, <i>kill -11</i>, <i>ulimit -c unlimited</i> and <i>jstack</i>) in:
<br/>
~/playground/java/examining-core-dump-of-frozen-java-program
<li>monitor and examine JVMs in the system</li>
There's a number of graphical utilities that allow one to view stacks, profile, examine memory usage etc.:
    <ul>
    <li><b>jvisualvm</b> - ships with Oracle JDK 7</li>
    <li><b>jconsole</b>
    </ul>
<li>list JVMs running in the system</li>
<pre>jps</pre>
... to also print the arguments passed to their <b>main</b> method use:
<pre>jps -p</pre>
<li>how to find from the command line if Java is 64 bit</li>
<pre>java -d64 -version</pre>
<li>JAX-WS 2.2.8 RI documentation and wsimport Ant task</li>
The documentation for the latest (at the time of this writing) JAX-WS RI (GlassFish Metro), including <b>wsimport</b> Ant task is found
<a href="https://jax-ws.java.net/2.2.8/docs/ch04.html#tools-wsimport">here</a>.
<li>how to configure **wsgen** as Ant task</li>
This <a href="http://stackoverflow.com/questions/5091573/taskdef-class-com-sun-tools-ws-ant-wsimport-cannot-be-found-following-the-java">SO post</a> is useful.
Also, check out the playground examples: +++
<li>how to find executable and Java version used by Ant</li>
There are three ways:
    <ol type="a">
    <li>I've created script <code>ant_mod</code> in <code>~/tools</code> which echoes the <code>java</code> executable used to spawn <code>ant</code></li>
    <li>use: <code>ant -verbose</code></li>
    <li>use: <code>ant -diagnostics | grep java.vm</code></li>
    </ol>
<li><a name="install-oracle7-ubuntu-12.04">install</a>Oracle JDK 7 on Ubuntu 12.04 (precise)</li>
On 2013-09-19 I followed <a href="http://askubuntu.com/questions/309900/installing-java-7-update-25-on-12-04-lts">these instructions</a>
and it worked fine. Basically I executed the following steps:<br/>
<pre>
sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java7-installer
</pre>
<br/><b>NB:</b> following the above, don't forget to update the JAVA_HOME, PATH and CLASSPATH variables, if set in .bashrc.
<br/><br/>
2014-06-02 UPDATE: I tried again the above procedure (this time only the <code>apt-get update/install</code> part) and it 
smoothly updated Java from 7u40 to 7u60. Also, after the update, the installation directory remained the same
(/usr/lib/jvm/java-7-oracle), so no updating of JAVA_HOME, PATH and CLASSPATH was required.
<br/><br/>
See some bullet points below for an alternative way that also seemed to have worked in the past.
<li>SAX vs DOM parsing in a nutshell</li>
    <ul><li>The SAX API is a widely accepted and well-working parser that is easy to implement and works especially well with streaming content (e.g. an online XML source). Because it is a read-only API, you would not be able to modify the underlying XML data source. Since it only reads one node at a time, it is very memory-efficient and fast. However, this implies that your application expects the information to be close together and ordered.</li>
<li>If you want to randomly access the entire document at any point of time, then the DOM approach might be a better choice for you. The DOM API is more complex and harder to implement, but gives you full control over the whole document and lets you modify the data, also. However, it reads the whole XML document into memory, so the DOM API is not suitable for projects with very large XML files.</li>
    </ul>
    <a href="http://en.wikibooks.org/wiki/XML_-_Managing_Data_Exchange/Parsing_XML_files">source</a>
<li>yet another way to install <b>Apache ivy</b> in Ubuntu</li>
NB: there's other notes on the same subject offering alternative ways. At the very least see <a href="#ivy-locations">this note on Ivy locations</a>. 
<br/>
This was discovered by way of experimentation, I am not sure how well advised it is:</p>
    <ol>
        <li>download and explode the ivy tarball (apache-ivy-2.2.0-bin.tar.gz)</li>
        <li>copy the file <b>ivy-2.2.0.jar</b> to where the Ant libs are kept:</li>
            <pre>sudo cp ivy-2.2.0.jar /usr/share/ant/lib/</pre>
        <li>run the <b>install</b> target in an Ant project of mine:</li>
            <pre>
cd ~/esavo-reg/playground/ivy/02-install
ant install
            </pre>
        <li>you're good to go!</li>
    </ol>
<li>install <b>Apache ivy</b> in Ubuntu</li>
NB: there's other notes on the same subject offering alternative ways. At the very least see <a href="#ivy-locations">this note on Ivy locations</a>.
<br/>
original article <a href="http://superuser.com/questions/452192/how-to-install-ant-ivy">here</a></p>
After doing an:
<pre>
sudo apt-get install ivy
</pre>
... the </b>ivy.jar</b> doesn't show up where it's supposed to (/usr/share/ant/lib) but is instead found in folders like /usrshare/doc/ivy and /usr/share/java/. </p>So one has to do a:
<pre>
sudo ln -s -T /usr/share/java/ivy.jar /usr/share/ant/lib/ivy.jar
</pre>
<li>install Oracle Java JDK 7 on Ubuntu 12.04 (precise)</li>
Original article <a href="http://www.magentodeveloperleedsuk.co.uk/installing-oracle-java-jdk-7-on-ubuntu-12-04-step-by-step/">here</a></p>
    <ol>
    <li>download the JDK tar.gz and extract it</li>
    <li>create a new folder:</li>
    <pre>sudo mkdir -p /usr/lib/jvm/jdk1.7.0</pre>
    <li>move the extracted contents of the JDK to the new location:</li>
    <pre>sudo mv <EXTRACTED_FOLDER>/* /usr/lib/jvm/jdk1.7.0/</pre>
    <li>run the following commands one by one:</li>
    <pre>
     sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jdk1.7.0/bin/java" 1
     sudo update-alternatives --install "/usr/bin/javac" "javac" "/usr/lib/jvm/jdk1.7.0/bin/javac" 1 
     sudo update-alternatives --install "/usr/bin/javap" "javap" "/usr/lib/jvm/jdk1.7.0/bin/javap" 1
     sudo update-alternatives --install "/usr/bin/javaws" "javaws" "/usr/lib/jvm/jdk1.7.0/bin/javaws" 1
     sudo update-alternatives --install "/usr/bin/jar" "jar" "/usr/lib/jvm/jdk1.7.0/bin/jar" 1
     sudo update-alternatives --install "/usr/bin/wsimport" "wsimport" "/usr/lib/jvm/jdk1.7.0/bin/wsimport" 1
     sudo update-alternatives --install "/usr/bin/xjc" "xjc" "/usr/lib/jvm/jdk1.7.0/bin/xjc" 1
    </pre>
    </ol>
    <p/><b>2013-06-05 update:</b></p>In an Ubuntu machine that had the OpenJDK JVM already installed (i.e. <b>java</b>
          but not <b>javac</b>, the first of the above series of instructions failed to change the version of java used
          (although it produced an exit code of 0). So I had to create the symbolic link myself. The rest of the commands
          succeeded. Maybe there exists a switch in <b>update-alternatives</b>
          that allows one to override previous alternatives (if that was the cause of this failure).
<li>Monitor a running JVM</li>
Use the <b>jvisualvm</b> Oracle program to attach to a running instance of the
JVM and display various graphs. See below a possible use that tries to attach
to the JBoss process (running in [s]tandal[one] mode):
<pre>
jvisualvm --openpid $(ps aux | grep java | grep tandal | awk '{print $2}'
</pre>
<li>JBoss Application Server configuration directory</li>
This comes handy for storing JBoss-specific configuration parameters
that cannot be part of an EAR:
<pre>
String serverConfUrl = System.getProperty("jboss.server.config.dir") ;
</pre>
<li>UTF8 encoding in Java</li>
In general problems may occur both in the compile stage (javac) and in the
execution stage (java). The following flags are pertinent:
<pre>
javac -encoding utf-8 X.java // or utf8, UTF-8, UTF8
java -Dfile.encoding=UTF8 X
</pre>
Even the two settings above may not solve the problem if the
font used by the terminal doesn't contain a rendering for a
particular character (e.g. the 0x0222 character in the example 
below).
<pre>
public class X {
    public static void main (String args[]) {
        System.out.println("\u0222");
    }
}
</pre>

Also, the file.encoding trick may be ok for a small console program
but maybe not with a server. You may want to use a special
PrintStream instead. That is because the JVM runtime
does attempt to find out what
character encoding the environment outside the JVM uses, and
apparently in your environment it gets a native character set
of something else that UTF8.

So, even if you have funky UTF-8 characters in your source,
Java may be able to print them out in environments with some
other native character encoding, if that other encoding
happens to have a code point for the same character glyph.

For example, source code with UTF-8 may contain the byte
sequence [0xc3, 0xa4], signifying lower-case a-diaeresis
character glyph. Now, if that source code is compiled
properly, letting the compiler know that the source is in UTF-8
character set, and subsequently the code is run in an environment
with ISO-8859-1 character set, the program will output just
one byte, 0xE4. Also, if the same code is run in an environment
configured for plain US-ASCII character set, it will output
only a question mark (as US-ASCII character set does not have
a glyph for the a-diaeresis character).

See <a href="http://www.velocityreviews.com/forums/t528998-javac-encoding-problem-and-or-glaring-bug.html">here
</a> for the full discussion.
<li>error:unmappable character for encoding Cp1252</li>
This is a problem that plagues Windows OS when
compiling Java sources.
Setting the following environment properties fixed
the problem in one occassion:
<pre>
ANT_OPTS
-Dfile.encoding=UTF8

JAVA_TOOL_OPTIONS
-Dfile.encoding=UTF8
</pre>

<li>useful bash scriplet to generate Java classpath</li>
Often a number of jars are located inside a given folder
(folder 'repo-wide-libs' in the example below). To construct
a Java classpath that will include them all, do a:
<pre>echo repo-wide-libs/*jar | sed 's, ,:,g'</pre>
Alternatively one can use <b>tr</b> instead of <b>sed</b>:
<pre>java -cp $(echo lib/*.jar | tr ' ' ':') ..</pre>
<li>how to solve '<i>unmappable character<i>' problems in '<i>javac<i>'</li>
The problem is usually solved by adding the following line in the &lt<b>javac</b>&gt
Ant task invocation:
<pre>
&ltcompilerarg line="-encoding utf-8"/&gt
</pre>
(see examplary java-se build.xml in archetypes/ant)<p>
On some occassions I've also used:
<pre>
&ltcompilerarg line="-encoding ISO-8859-1"/&gt
</pre>
<li>install Oracle Java in Ubuntu</li>
(<href="http://www.webupd8.org/2012/01/install-oracle-java-jdk-7-in-ubuntu-via.html">source</href>)To install the latest Oracle Java 7 in Ubuntu (supports Ubuntu 12.04, 11.10, 11.04 and 10.04), use the commands below:
<pre>
sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java7-installer
</pre>

After the installation finishes, if you wish to see if it was successful, you can run the following command:

<pre>java -version</pre>

It should return something like this:
<pre>
java version "1.7.0_04"
Java(TM) SE Runtime Environment (build 1.7.0_04-b20)
Java HotSpot(TM) Server VM (build 23.0-b21, mixed mode)
</pre>
</ol>
</body>
</html>
