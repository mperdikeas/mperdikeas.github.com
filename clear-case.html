<html>
  <head>
    <link type="text/css" rel="stylesheet" href="mperdikeasgithub.css"/>
    <link rel='icon' href='/knowledge-favicon.ico'/>
  </head>
  <body>
    <ol class='main-list-items' reversed>
      <li>create (and commit) a directory in ClearCase</li>
      <pre>
    ct co &lt;parent directory&gt;
    ct mkdir dirname
    ct ci &lt;parent directory&gt;</pre>
      <li>commit an existing file in ClearCase</li>
      <pre>
    ct co &lt;parent directory&gt;
    ct mkelem -ci file
    ct ci &lt;parent directory&gt;</pre>
      <li>working directly on the filesystem in ClearCase (not inside an extra shell using <tt>setview</tt>)</li>
      <p>
        See the following SO question of mine:
        <ul>
          <li><a href='http://stackoverflow.com/q/40347421/274677'>working in /vobs/some/path versus /view/view-tag-name/vobs/some/path</a></li>
        </ul>
      </p>
      <p>Bottom line is that <tt>ct setview</tt> is evil and you can simply work in <tt>/view/view-tag-name/vobs/some/path</tt>.
        I've also confirmed that with colleagues. The only caveat is that I've only tried this with dynamic views (not snapshots).
      </p>
      <li>awesome tool to import an arbitrary directory structure into a ClearCase view</li>
      <p>
        The <code>clearfsimport</code> makes working with the ClearCase abomination borderline bearable.
        In the below incantation assume that:
        <ul>
          <li>the current directory is some ClearCase dynamic view</li>
          <li>the path <code>/tmp/foo</code> is just a random filesystem directory, outside of ClearCase</li>
        </ul>
        <pre>clearfsimport -recu -nset /tmp/foo/ . </pre>
      </p>
      <p>For some inscrutable reason the <code>-nset</code> flag is essential. For more see
        <a href='http://stackoverflow.com/q/42371537/274677'>here</a>.</p>
      <p>
        To perform an update (after the initial import) simply additionally use the <tt>-rmname</tt> flag
        in the above incantation:
        <pre>clearfsimport -recu -nset -rmname /tmp/foo/ .</pre>
        For more on the update functionality, see <a href='http://stackoverflow.com/q/42396640/274677'>here</a>.
      </p>
      <p>Following the above don't forget to add write privilleges to directories for user and group
        as advised <a href='#p:ct-protect'>here</a>.</p>
      <p>
        Note that I've only tried the above in dynamic views, not snapshots.
      </p>

      <li>some useful commands I used recently (unordered)</li>
      <pre>
ct ls -l
ct ls -view_only
ct ls -rec -view_only
ct lshistory
ct lsprivate -co
ct unco
ct des .
ct lsco
ct lsco -dir .
ct lsco -recu foo
ct lsco -me -recu
ct mkelem -mkpath dir-or-source-file
ct diff -diff -pre Makefile
cat Makefile@@/main/dbdev_br/1</pre>
      <li>remove a file or directory (recursively) in ClearCase</li>
      <pre>
$ ct co .
$ ct rm foo
$ ct ci . </pre>
      <p>
        <tt>rm</tt> is an alias for <tt>rmname</tt>.
      </p>
      <p>
        At this point in time it is not clear to me how <tt>rm</tt> / <tt>rmname</tt> is different
        from <tt>ct rmelem</tt>. Our ClearCase resident expert
        suggested using <tt>ct rm/rmname</tt> and that indeed does the trick (recursively)
      </p>
      <p>My impression at the moment is that <tt>rmelem</tt> is of a more permanent nature whereas
        with <tt>rmname</tt> you maintain history.
      </p>
      
      <li>commit an arbitrary tree (with symlinks and all) to ClearCase</li>
      <a href='http://stackoverflow.com/a/42375618/274677'>source</a>
      <p>
      First move it out of the dynamic view (say to <tt>/tmp/some-tree</tt>), and then issue:
        <pre>$ clearfsimport -recu -nset ~/tmp/some-tree/ .</pre>
      </p>
      <p id='p:ct-protect'>
        Following the above, I have been advised (by CfA people) to also issue the following (after doing a <tt>cd</tt> to <tt>some-tree</tt>):
        <pre>ct protect -chmod ug+w $(find -type d)</pre>
      </p>      
      <li>find whether the current directory is checked out</li>
      <pre>ct des . | grep check</pre>
      &hellip; or:
      <pre>ct lsco -dir .</pre>
      <li>how to find view-private objects</li>
      <p>
        In the current directory only (non recursively):<pre>ct ls -l | grep private</pre>

      &hellip; alternatively:
        <pre>ct ls -view_only</pre>
      </p>
      <p>Recursively, under the current directory:
        <pre>ct lsprivate .</pre>
        &hellip; alternatively:
        <pre>ct ls -view_only -recurse</pre>
      </p>
      <p>NB: some of the above incantations may return both view-private and checked-out objects.</p>
      <li>remove a dir and all its sub-directories</li>
      <p>
        
        Say you wish to remove directory <tt>dir-to-remove</tt> in present directory.
        <pre>
ct co -nc .
ct rmname dir-to-remove
ct ci .</pre>
<tt>-nc</tt> stands for <i>no comment</i>
      </p>
      <li>how to delete a view in ClearCase</li>
      I have only tried this with a snapshot view but I believe it works with dynamic views
      as well:
      <pre>
ct rmview -f -tag mperdike_dev_viewsnap
      </pre>
      <p>
      From what I observed this deletes the (server-side) "view storage directory" that's provided with
      the <code>-vws</code> in the <code>ct mkview</code> invocation for a <a href='#create-snapshot-view'>snapshot view</a>.
      I believe I had to delete the "snapshot view directory" (in my local file system) manually.
      </p>
       <li id='create-snapshot-view'>how to create a snapshot view in ClearCase</li>
      Here's the incantation I recently used:
      <pre>
ct mkview -sna -tag mperdike_dev_viewsnap -vws /data/VIEWS/mperdike_dev_viewsnap.vws -host serverhostname -hpath /data/VIEWS/mperdike_dev_viewsnap.vws -gpath /data/VIEWS/mperdike_dev_viewsnap.vws /export/mperdike/cc-snap-views/mperdike-dev-viewsnap</pre>
      Here's my understanding:
      <ul>
        <li><dt><code>-sna</code></dt><dd>this flag triggers the creation of a snapshot view (as opposed to a dynamic view)</dd>
        <li>the <code>-tag</code>, <code>-hpath</code>, <code>-gpath</code> arguments have the same meaning as in the creation of a <a href='#create-dynamic-view'>dynamic view</a></li>
        <li><dt><code>-vws</code></dt><dd>this is an argument that uniquely applies in the case of the snapshot views only.
          It provides the "view storage directory" on the server. In the case of dynamic views the same information is passed
          not through an optional argument but as the mandatory last argument (described in the documentation as "dynamic-view-storage-pname"
          or "dynamic-view-pname")</dd></li>
        <li>the last argument (<tt>/export/mperdike/cc-snap-views/mperdike-dev-viewsnap</tt> in the above incantation) is the location on my local filesystem where
          the snapshot view will be created. I have seen this being referred in the documentation as "snapshot view directory"</li>
      </ul>
      <p>
      Following the creation of the snapshot view, it is of course empty and one has to edit the config spec. In my case, I already had a dynamic view and just
      wanted the snapshot view to mirror the dynamic view, so I did a:
      <code>ct catcs</code> in the dynamic view and then used <code>ct edcs</code> in the snapshot view to copy
      (verbatim) all rules (selection rules) that appeared in the dynamic view config spec.
      Following that, I added (in my case) a single load rule specifying the vob I wanted to load.
      </p>
      <p>
        So in my case, the dynamic view config spec is:
        <pre>
$ ct catcs
element * CHECKEDOUT
element src/db/... .../dbdev_br/LATEST
element * /main/LATEST -mkbranch dbdev_br </pre>
        &hellip; whereas the snapshot view config spec is:
        <pre>
$ ct catcs
element * CHECKEDOUT
element src/db/... .../dbdev_br/LATEST
element * /main/LATEST -mkbranch dbdev_br
load /vobs/ASC_DB_ADMIN/ </pre>
      </p>
      <p>
        Once the snapshot view's config spec was saved, stuff started to get downloaded. I noticed that in addition to
        the vob I specified some additional ones were downloaded (presumably due to some dependency?).
      </p>
      </li>
      <li id='create-dynamic-view'>how to create a dynamic view in ClearCase</li>
      <pre>ct mkview -tag mperdike_dev_view -host serverhostname -hpath /data/VIEWS/mperdike_dev_view.vws -gpath /data/VIEWS/mperdike_dev_view.vws /data/VIEWS/mperdike_dev_view.vws</pre>
      Here's my understanding:
      <ul>
        <li><dt><code>-host</code></dt><dd>the <code>-host</code> argument should provide the server where CC runs</dd></li>
        <li><dt><code>-tag</code></dt><dd>the <code>-tag</code> argument provides the view tag (i.e. a friendly name)</dd></li>
        <li>the <code>-hpath</code> and <code>-gpath</code> arguments as well as the last mandatory parameter take their names
          (as a convention I guess) from the <code>-tag</code> argument and basically specify the view storage location on the server.
          On my machine the <code>/data/VIEWS</code> directory is mounted on an NFS filesystem:
          <pre>
$ df -P -T /data/VIEWS | tail -n +2 | awk '{print $2}'
nfs </pre></li>
      </ul>
      <li>common helpful aliases for ClearCase</li>
      <pre>
alias ct=cleartool
alias ci=checkin
alias co=checkout
alias uco='uncheckout'
alias xcc='setenv LANG en_US; xclearcase &'
alias cmake='clearmake -C gnu MAKE=clearmake UIROOT=/vobs/ASC_BUILD/src'
alias ctmv='ct setview -exec "newgrp ccase" mperdike_dev_view'</pre>
      <p>Regarding the last of the above aliases (<tt>ctmv</tt>), it seems there is no actual need
        to use <tt>setview</tt>. <tt>setview</tt> spawns a second shell and you are expected
        to navigate to, e.g. <tt>/vobs/ASC_DB_ADMIN</tt> to do your work. Instead, one can
        simply navigate to (in my case) <tt>/view/mperdike_dev_view/vobs/ASC_DB_ADMIN</tt> and have access
        to the exact same information without having to spawn a second shell ontop of the
        existing one (which can cause problems). See <a href='http://stackoverflow.com/q/40347421/274677'>this
        relevant SO question</a>.
      </p>
      <p><b>NB:</b> you will notice that the <tt>ctmv</tt> alias above sets the group as well.
        As such, when one navigates directly to <tt>/view/view_tag_name/vobs/ASC_DB_ADMIN</tt>
        directory the group has to be properly set (with <code>newgrp ccase</code>)
        otherwise some common check-out / check-in commands won't work.
      </p>
    </ol>
  </body>
</html>
